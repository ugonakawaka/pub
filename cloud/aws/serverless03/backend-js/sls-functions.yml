custom:
  cmn: ${file(../config/common.yml)}
  env: ${file(../config/${opt:stage}.yml)}
  layerArn:
    Fn::ImportValue: ${self:custom.cmn.services.baseName}-${opt:stage}-layerJs-LayerCommonJsArn

service: ${self:custom.cmn.services.baseName}-${opt:stage}-funcs-js

provider:
  name: aws
  runtime: ${self:custom.cmn.backend-js.runtime}
  region: ${self:custom.cmn.region}
  stackName: ${self:service}
  # environment:
  #   DATABASE_URL: ${ssm:/${self:custom.env.stage}/DATABASE_URL}  # SSMパラメータストアから値を取得

package:
  individually: true

functions:
  hello:
    handler: dist/handlers/handler.handler
    package:
      patterns:
        - "!**/*" # 全て除外
        - "dist/**" # dist ディレクトリのみを含める
    layers:
      - ${self:custom.layerArn} # Lambda関数でレイヤーを使用
    events:
      - http:
          path: /{proxy+} # ワイルドカードで全てのパスを受け付ける
          method: any # 全てのHTTPメソッドを受け付ける

plugins:
  - serverless-offline
